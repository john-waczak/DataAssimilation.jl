<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Kalman Filter · DataAssimilation.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://john-waczak.github.io/DataAssimilation.jl/dataAssimilation/kalman/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DataAssimilation.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Data Assimilation</span><ul><li><a class="tocitem" href="../dataassim/">Data Assimilation Oveview</a></li><li class="is-active"><a class="tocitem" href>Kalman Filter</a><ul class="internal"><li><a class="tocitem" href="#Forecast-Step"><span>Forecast Step</span></a></li><li><a class="tocitem" href="#Data-Assimilation-Step"><span>Data Assimilation Step</span></a></li></ul></li><li><a class="tocitem" href="../ekf/">Extended Kalman Filter</a></li></ul></li><li><a class="tocitem" href="../../fdocs/">Function docs</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Data Assimilation</a></li><li class="is-active"><a href>Kalman Filter</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Kalman Filter</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/john-waczak/DataAssimilation.jl/blob/master/docs/src/dataAssimilation/kalman.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Kalman-Filtering"><a class="docs-heading-anchor" href="#Kalman-Filtering">Kalman Filtering</a><a id="Kalman-Filtering-1"></a><a class="docs-heading-anchor-permalink" href="#Kalman-Filtering" title="Permalink"></a></h1><p>Given some model for the error covariance matrices <span>$Q_k$</span> and <span>$R_k$</span>, we would like a method that propagates <em>both</em> our model <strong>and</strong> the errors forward. This way we may guarantee that the accuracy of our analysis doesn&#39;t come at the cost of higher uncertainty. </p><p>The original implementation of the Kalman filter was for strictly linear systems. We will first develop the analysis for this simplified case adn then will generalize to the <strong>Extended Kalman Filter</strong> (EKF) that can handle fully nonlinear situations.</p><p>In the linear case, our system may be written as </p>$<p>\begin{aligned}     u<em>{k+1}^{(t)} &amp;= M</em>ku<em>k^{(t)} + \xi</em>{k+1}^{(p)} \      w<em>k &amp;= H</em>ku<em>k^{(t)} + \xi</em>k^{(m)} \end{aligned} $</p><p>where <span>$M_k$</span> and <span>$H_k$</span> are now matrices defining the linear problem. </p><p>The goal of the Kalman filter is to derive the analysis <span>$u^{(a)}$</span> which optimizes the trace of the analysis error covariance matrix (i.e. sum of squared errors): </p>$<p>\mathrm{Tr}\left( P<em>k\right) := \E[(u</em>k^{(t)}-u<em>k^{(a)})^T(u</em>k^{(t)}-u_k^{(a)})] $</p><p>Finding the analysis consists of two steps: the forecast step and the assimilation step.</p><h2 id="Forecast-Step"><a class="docs-heading-anchor" href="#Forecast-Step">Forecast Step</a><a id="Forecast-Step-1"></a><a class="docs-heading-anchor-permalink" href="#Forecast-Step" title="Permalink"></a></h2><p>Assume we have the analysis at time <span>$t_k$</span> denoted <span>$u_k^{(a)}$</span>. Then the forecast for time <span>$t_{k+1}$</span> is</p>$<pre><code class="nohighlight hljs">u_{k+1}^{(b)} = M_ku_k^{(a)}</code></pre>$<p>The background error is therefore </p>$<p>\begin{aligned}     \xi<em>{k+1}^{(b)} &amp;= u</em>{k+1}^{(t)} - u<em>{k+1}^{(b)} \      &amp;= M</em>ku<em>k^{(t)}+\xi</em>{k+1}^{(p)} - M<em>{k}u</em>k^{(a)} \      &amp;= M<em>k\left(u</em>k^{(t)}-u<em>k^{(a)} \right) + \xi</em>{k+1}^{(p)} \      &amp;= M<em>k\xi</em>k^{(a)} + \xi_{k+1}^{(p)} \end{aligned} $</p><p>We may now evaluate the covariance matrix of our background estimate as: </p>$<p>\begin{aligned}     B<em>{k+1} &amp;= \E[\xi</em>{k+1}^{(b)}(\xi<em>{k+1}^{(b)})^T] \      &amp;= \E\left[\left(M</em>k\xi<em>k^{(a)} + \xi</em>{k+1}^p \right) \left(M<em>k\xi</em>k^{(a)} + \xi_{k+1}^p \right)^T \right] \  \end{aligned} $</p><p>If we presume that <span>$\E[\xi_k^{(b)}(\xi_{k+1}^{(p)})^T] = 0$</span>, then the cross terms vanish and we are left with </p>$<p>\boxed{B<em>{k+1} = M</em>kP<em>kM</em>k^T + Q_{k+1}} $</p><p>Thus we now have the background (i.e forecast) estimate of the state at <span>$t_{k+1}$</span> and its covariance matrix. Given a measurement <span>$w_{k+1}$</span> at the same time with covariance matrix <span>$R_{k+1}$</span>, then we may now perform the assimilation step where we fuse the two sources of information to obtain <span>$u_{k+1}^{(a)}$</span> and <span>$P_{k+1}$</span>.</p><h2 id="Data-Assimilation-Step"><a class="docs-heading-anchor" href="#Data-Assimilation-Step">Data Assimilation Step</a><a id="Data-Assimilation-Step-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Assimilation-Step" title="Permalink"></a></h2><p>Let&#39;s suppose that the analysis has the form </p>$<p>u<em>{k+1}^{(a)} = \nu + K</em>{k+1}w_{k+1} $</p><p>for some vector <span>$\nu\in\R^n$</span> and matrix <span>$K_{k+1}\in\R^{m\times n}$</span>. In a perfect world, we would have <span>$\E[u_{k}^{(t)}-u_{k}^{(a)}] = 0$</span>. Therefore, </p>$<p>\begin{aligned}     0 &amp;= \E[u<em>k^{(t)} - u</em>k^{(a)}] \      &amp;= \E[(u<em>k^{(b)} + \xi</em>k^{(b)}) - (\nu + K<em>kw</em>k)] \      &amp;= \E[(u<em>k^{(b)} + \xi</em>k^{(b)}) - (\nu + K<em>kH</em>ku<em>k^{(t)} + K</em>k\xi<em>k^{(m)})] \      &amp;= \E[u</em>k^{(b)}] + \E[\xi<em>k^{(b)}] - \E[\nu] -K</em>kH<em>k\E[u</em>k^{(t)}] - K<em>k\E[\xi</em>k^{(m)}]\
    &amp;= u<em>k^{(b)} + 0 - \nu - K</em>kH<em>ku</em>k^{(b)} - 0 \      &amp;= u<em>k^{(b)} - \nu - K</em>kH<em>ku</em>k^{(b)} \      \Rightarrow \nu &amp;= u<em>k^{(b)} - K</em>kH<em>ku</em>k^{(b)} \end{aligned} $</p><p>which we now substitute to obtain </p>$<p>\boxed{u<em>k^{(a)} = u</em>k^{(b)} + K<em>k(w</em>k - H<em>ku</em>k^{(b)})} $</p><p>Now that we know the form for the analysis we may derive the optimal matrix <span>$K_k$</span> by optimization of <span>$P_k$</span>. We have</p>$<p>\begin{aligned} 	\xi<em>k^{(a)} &amp;= u</em>k^{(t)} - u<em>k^{(a)} \                  &amp;= M</em>{k-1}u<em>{k-1}^{(t)} + \xi</em>{k}^{(p)} - u<em>k^{(b)} - K</em>k\left(w<em>k - H</em>ku<em>k^{(b)} \right) \                  &amp;= M</em>{k-1}u<em>{k-1}^{(t)} + \xi</em>{k}^{(p)} - M<em>{k-1}u</em>{k-1}^{(a)} - K<em>k\left(H</em>ku<em>k^{(t)} + \xi</em>k^{(m)} - H<em>ku</em>k^{(b)} \right) \                  &amp;= M<em>{k-1}u</em>{k-1}^{(t)} + \xi<em>{k}^{(p)} - M</em>{k-1}u<em>{k-1}^{(a)} - K</em>kH<em>ku</em>k^{(t)} - K<em>k\xi</em>k^{(m)} + K<em>kH</em>ku_k^{(b)} \ </p><pre><code class="nohighlight hljs">            &amp;= M_{k-1}u_{k-1}^{(t)} + \xi_{k}^{(p)} - M_{k-1}u_{k-1}^{(a)} - K_kH_ku_k^{(t)} - K_k\xi_k^{(m)} + K_kH_ku_k^{(b)} \\ 
            &amp;= \Big\{ M_{k-1}(\xi_{k-1}^{(a)}+u_{k-1}^{(a)}) + \xi_{k}^{(p)} - M_{k-1}u_{k-1}^{(a)} \Big\} - K_kH_ku_k^{(t)} - K_k\xi_k^{(m)} + K_kH_ku_k^{(b)} \\ 
            &amp;= \Big\{ M_{k-1}\xi_{k-1}^{(a)} + \xi_{k}^{(p)} \Big\} - K_kH_ku_k^{(t)} + K_kH_ku_k^{(b)} - K_k\xi_k^{(m)}\\ 
            &amp;= M_{k-1}\xi_{k-1}^{(a)} + \xi_{k}^{(p)} - K_kH_k(M_{k-1}u_{k-1}^{(t)} + \xi_k^{(b)}) + K_kH_ku_k^{(b)} - K_k\xi_k^{(m)}\\ 
            &amp;= M_{k-1}\xi_{k-1}^{(a)} + \xi_{k}^{(p)} - K_kH_kM_{k-1}(\xi_{k-1}^{(a)} + u_{k-1}^a) - K_kH_k\xi_k^{(b)} + K_kH_ku_k^{(b)} - K_k\xi_k^{(m)}\\ 
            &amp;= M_{k-1}\xi_{k-1}^{(a)} + \xi_{k}^{(p)} - K_kH_kM_{k-1}(\xi_{k-1}^{(a)} + u_{k-1}^a) - K_kH_k\xi_k^{(b)} + K_kH_kM_{k-1}u_{k-1}^{(a)} - K_k\xi_k^{(m)}\\ 
            &amp;= M_{k-1}\xi_{k-1}^{(a)} + \xi_{k}^{(p)} - K_kH_kM_{k-1}\xi_{k-1}^{(a)} - K_kH_k\xi_k^{(b)} - K_k\xi_k^{(m)}\\ 
            &amp;= \big(I-K_kH_k \big)(M_{k-1}\xi_{k-1}^{(a)} - \xi_{k}^p) - K_k\xi_k^{(m)}\\</code></pre><p>\end{aligned} $</p><p>and therefore the covariance matrix is </p>$<p>\begin{aligned}     P<em>k &amp;= \E[\xi</em>{k}^{(a)}(\xi<em>{k}^{(a)})^T] \          &amp;= \E\Big[\left(\big(I-K</em>kH<em>k \big)(M</em>{k-1}\xi<em>{k-1}^{(a)} - \xi</em>{k}^p) - K<em>k\xi</em>k^{(m)} \right) \left(\big(I-K<em>kH</em>k \big)(M<em>{k-1}\xi</em>{k-1}^{(a)} - \xi<em>{k}^p) - K</em>k\xi<em>k^{(m)} \right)^T \Big] \          &amp;= \big(I-K</em>kH<em>k \big)M</em>{k-1}\E[\xi<em>{k-1}^{(a)}(\xi</em>{k-1}^{(a)})^T]M<em>{k-1}^T\big(I-K</em>kH<em>k \big)^T + \big(I-K</em>kH<em>k \big)\E[\xi</em>k^{(p)}(\xi<em>k^{(p)})^T]\big(I-K</em>kH<em>k \big)^T - K</em>k\E[\xi<em>{k}^{(m)}(\xi</em>k^{(m)})^T]K<em>k^T \          &amp;= \big(I-K</em>kH<em>k \big)B</em>k\big(I-K<em>kH</em>k \big)^T - K<em>kR</em>kK_k^T \end{aligned} $</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../dataassim/">« Data Assimilation Oveview</a><a class="docs-footer-nextpage" href="../ekf/">Extended Kalman Filter »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Tuesday 10 May 2022 23:39">Tuesday 10 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
